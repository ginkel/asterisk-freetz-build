--- asterisk-1.6.0.19.orig/contrib/scripts/safe_asterisk	2009-05-26 15:07:29.000000000 +0200
+++ asterisk-1.6.0.19/contrib/scripts/safe_asterisk	2009-12-20 14:04:36.114689659 +0100
@@ -1,9 +1,9 @@
-#!/bin/sh
+#!/bin/bash
 # vim:textwidth=80:tabstop=4:shiftwidth=4:smartindent:autoindent
 
 CLIARGS="$*"				# Grab any args passed to safe_asterisk
-TTY=9						# TTY (if you want one) for Asterisk to run on
-CONSOLE=yes					# Whether or not you want a console
+#TTY=9						# TTY (if you want one) for Asterisk to run on
+CONSOLE=no					# Whether or not you want a console
 #NOTIFY=ben@alkaloid.net	# Who to notify about crashes
 #EXEC=/path/to/somescript	# Run this command if Asterisk crashes
 #LOGFILE=/path/to/logfile	# Where to place the normal logfile (disabled if blank)
@@ -18,9 +18,6 @@
 # asterisk exits
 KILLALLMPG123=1
 
-# run asterisk with this priority
-PRIORITY=0
-
 # set system filemax on supported OSes if this variable is set
 # SYSMAXFILES=262144
 
@@ -98,11 +95,6 @@
 fi
 
 #
-# Let Asterisk dump core
-#
-ulimit -c unlimited
-
-#
 # Don't fork when running "safely"
 #
 ASTARGS=""
@@ -120,10 +112,6 @@
 		ASTARGS="${ASTARGS} -c"
 	fi
 fi
-if [ ! -w ${DUMPDROP} ]; then	
-	message "Cannot write to ${DUMPDROP}"
-	exit 1
-fi
 
 #
 # Don't die if stdout/stderr can't be written to
@@ -149,10 +137,10 @@
 		if [ "$TTY" != "" ]; then
 			cd /tmp
 			stty sane < /dev/${TTY}
-			nice -n $PRIORITY ${ASTSBINDIR}/asterisk -f ${CLIARGS} ${ASTARGS} >& /dev/${TTY} < /dev/${TTY}
+			${ASTSBINDIR}/asterisk -f ${CLIARGS} ${ASTARGS} >& /dev/${TTY} < /dev/${TTY}
 		else
 			cd /tmp
-			nice -n $PRIORITY ${ASTSBINDIR}/asterisk -f ${CLIARGS} ${ASTARGS}
+			${ASTSBINDIR}/asterisk -f ${CLIARGS} ${ASTARGS}
 		fi
 		EXITSTATUS=$?
 		message "Asterisk ended with exit status $EXITSTATUS"
@@ -171,22 +159,8 @@
 			if [ "$EXEC" != "" ]; then
 				$EXEC
 			fi
-
-			PID=`cat ${ASTPIDFILE}`
-			if [ -f /tmp/core.${PID} ]; then
-				mv /tmp/core.${PID} ${DUMPDROP}/core.`hostname`-`date -Iseconds` &
-			elif [ -f /tmp/core ]; then
-				mv /tmp/core ${DUMPDROP}/core.`hostname`-`date -Iseconds` &
-			fi
 		else
 			message "Asterisk died with code $EXITSTATUS."
-
-			PID=`cat ${ASTPIDFILE}`
-			if [ -f /tmp/core.${PID} ]; then
-				mv /tmp/core.${PID} ${DUMPDROP}/core.`hostname`-`date -Iseconds` &
-			elif [ -f /tmp/core ]; then
-				mv /tmp/core ${DUMPDROP}/core.`hostname`-`date -Iseconds` &
-			fi
 		fi
 		message "Automatically restarting Asterisk."
 		sleep $SLEEPSECS
